<!DOCTYPE html>
<html>
<head>
    <title></title>
</head>
<body>

<div id="mediaEditPage" data-role="page" data-add-back-btn="true" data-back-btn-text="back" data-back-btn-theme="c">

<div data-theme="c" data-role="header" >
    <h1>Add Media</h1>
</div>

<div data-role="content">
    <p>Add media page test</p>


    <section class="ui-grid-a">
        <div class="ui-block-a">
            <div data-role="fieldcontainer">
                <label for="editTitleTxt">Title:</label><input type="text" id="editTitleTxt"  length=80 placeholder="Enter a Title for this Media">
            </div>
            <div data-role="fieldcontainer">
                <label for="editDateTxt">Date Taken:</label><input type="number"  id="editDateTxt" >
            </div>
            <div data-role="fieldcontainer">
                <label for="editDescrTxt">Description:</label><textarea rows="4" cols="50" id="editDescrTxt" length=200 placeholder="Enter a descrition for this media"></textarea>
            </div>
            <div data-role="fieldcontainer">
                <div id="editCategoryDiv">
                    <label for="editCategoryList">Categories</label>
                    <select id="editCategoryList"  multiple >
                        <!--<option value="1">red</option>-->
                        <!--<option value="2">green</option>-->
                        <!--<option value="3">yellow</option>-->
                        <!--<option value="4">blue</option>-->
                    </select>
                </div> <!-- categoryDiv -->
            </div>
        </div>
        <div class="ui-block-b">
            <div data-role="fieldcontainer">
            <img id="editImage" heigth=360 width=270 >
                </div>
            <!--<label for="fileInfoTxt">File Info:</label><input type="text" id="fileInfoTxt" name="fileInfoTxt" >-->
            <!--<label for="fileLocTxt">File Loc:</label><input type="text" id="fileLocTxt" name="fileLocTxt" >-->
            <!--<button id="uploadBtn" name="uploadBtn">Upload My Media</button>-->
            <div data-role="fieldcontainer">
            <a href="#editConfirm" data-rel="popup">Edit My Media</a>
            </div>
            <!--<label for="fileUploadTxt">Upload Info:</label><input type="text" id="fileUploadTxt" name="fileUploadTxt" >-->
        </div>

    </section>


    <div data-role="popup" id="editConfirm">
        <p>Are you sure?</p>
        <a href="#" data-rel="back" data-role="button" data-theme="a" >Cancel</a>
        <button id="editBtn" name="editBtn"> Yes! Edit My Media</button>
    </div>



</div>

    <script>

        var serviceURL = tsServiceURLDomain + "tssvc/resourcesS/media";
        var serviceCategoryURL = tsServiceURLDomain + "tssvc/resourcesS/categories";

        console.log("editmedia js: Executing");
        console.log("mediaPage: executing using services at: " + serviceURL);
        console.log("testCapturePageAdd: executing using category services at: " + serviceCategoryURL);

//
        $('#mediaEditPage').bind('pageinit', function(event) {
            console.log('mediaEditPage: bind: pageinit()');

        })

        $(document).on('pagebeforeshow', '#mediaEditPage', function(){
            console.log('mediaEditPage: pagebeforeshow()');

            console.log("activePage: " + $.mobile.activePage.data('url')   );
            console.log("urlHistory: " + $.mobile.urlHistory.getActive().url)   ;

            var mediaId = getUrlVars() ["id"];

            console.log ("id=" + mediaId);
            var categoryResultArray = new Array();

            $.getJSON(serviceURL + '/' + mediaId, function(data) {

                console.log("mediaEditpage: Title : " + data.title);
                console.log("mediaEditpage: Created : " + data.mediaDateRaw);
                console.log("mediaEditpage: Descr : " + data.descr);

                // Build array of selected categories, use to set the 'selected' values
                var iItr = 0;
                for(var i in data.categoryList)    {
                    //console.log("index: " + iItr);
                    //console.log("value: " + i)  ;
                    categoryResultArray.push([i])  ;
                    iItr = Number(iItr) + 1;
                }
                $('#editTitleTxt').val(data.title);
                $('#editDateTxt').val(data.mediaDateRaw);
                $('#editDescrTxt').val(data.descr);
                $('#editImage').attr("src", data.url);

                $.getJSON(serviceCategoryURL, function(data) {

                    cat = data.categoryModelList;
                    $.each(cat, function(index, item) {
                        var optionListItem = "<option value='" + item.categoryId + "'>" +item.categoryDescr + "</option>";
                        console.log("option Item: " + optionListItem);
                        $('#editCategoryList').append("<option value='" + item.categoryId + "'>" +item.categoryDescr + "</option>");
                    });

                    // make selected any items that are in the result array
                    console.log("Category Array outer processing.  Length: " + categoryResultArray.length) ;
                    for(i = 0; i < categoryResultArray.length; i++) {
                        console.log("value at index: " + i + " is " + categoryResultArray[i] )
                        $("#editCategoryList option[value='"+categoryResultArray[i]+"']").attr('selected', 'selected');
                    }
                    $('#editCategoryList').selectmenu("refresh", true);
                });

            });




        });    // end of pagebeforeshow

        function getUrlVars() {

            var vars = [], hash;
            var hashes = window.location.href.slice(window.location.href.indexOf('?') + 1).split('&');

            for(var i = 0; i < hashes.length; i++)
            {
                hash = hashes[i].split('=');
                vars.push(hash[0]);
                vars[hash[0]] = hash[1];
            }
            return vars;
        }

    </script>

    </div>


</body>
</html>